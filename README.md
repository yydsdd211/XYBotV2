# ğŸ¤– XYBot V2

XYBot V2 æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„å¾®ä¿¡æœºå™¨äººæ¡†æ¶,æ”¯æŒå¤šç§äº’åŠ¨åŠŸèƒ½å’Œæ¸¸æˆç©æ³•ã€‚

# âœ¨ ä¸»è¦åŠŸèƒ½

## ğŸ› ï¸ åŸºç¡€åŠŸèƒ½

- ğŸ¤– AIèŠå¤© - æ”¯æŒæ–‡å­—ã€å›¾ç‰‡ã€è¯­éŸ³ç­‰å¤šæ¨¡æ€äº¤äº’
- ğŸ“° æ¯æ—¥æ–°é—» - è‡ªåŠ¨æ¨é€æ¯æ—¥æ–°é—»
- ğŸµ ç‚¹æ­Œç³»ç»Ÿ - æ”¯æŒåœ¨çº¿ç‚¹æ­Œ
- ğŸŒ¤ï¸ å¤©æ°”æŸ¥è¯¢ - æŸ¥è¯¢å…¨å›½å„åœ°å¤©æ°”
- ğŸ® æ¸¸æˆåŠŸèƒ½ - äº”å­æ£‹ã€æˆ˜äº‰é›·éœ†ç©å®¶æŸ¥è¯¢ç­‰

## ğŸ’ ç§¯åˆ†ç³»ç»Ÿ

- ğŸ“ æ¯æ—¥ç­¾åˆ° - æ”¯æŒè¿ç»­ç­¾åˆ°å¥–åŠ±
- ğŸ² æŠ½å¥–ç³»ç»Ÿ - å¤šç§æŠ½å¥–ç©æ³•
- ğŸ§§ çº¢åŒ…ç³»ç»Ÿ - ç¾¤å†…å‘ç§¯åˆ†çº¢åŒ…
- ğŸ’° ç§¯åˆ†äº¤æ˜“ - ç”¨æˆ·é—´ç§¯åˆ†è½¬è´¦
- ğŸ“Š ç§¯åˆ†æ’è¡Œ - æŸ¥çœ‹ç§¯åˆ†æ’å

## ğŸ‘® ç®¡ç†åŠŸèƒ½

- âš™ï¸ æ’ä»¶ç®¡ç† - åŠ¨æ€åŠ è½½/å¸è½½æ’ä»¶
- ğŸ‘¥ ç™½åå•ç®¡ç† - æ§åˆ¶æœºå™¨äººä½¿ç”¨æƒé™
- ğŸ“Š ç§¯åˆ†ç®¡ç† - ç®¡ç†å‘˜å¯è°ƒæ•´ç”¨æˆ·ç§¯åˆ†
- ğŸ”„ ç­¾åˆ°é‡ç½® - é‡ç½®æ‰€æœ‰ç”¨æˆ·ç­¾åˆ°çŠ¶æ€

# ğŸ”Œ æ’ä»¶ç³»ç»Ÿ

XYBot V2 é‡‡ç”¨æ’ä»¶åŒ–è®¾è®¡,æ‰€æœ‰åŠŸèƒ½éƒ½ä»¥æ’ä»¶å½¢å¼å®ç°ã€‚ä¸»è¦æ’ä»¶åŒ…æ‹¬:

- ğŸ‘¨â€ğŸ’¼ AdminPoint - ç§¯åˆ†ç®¡ç†
- ğŸ”„ AdminSignInReset - ç­¾åˆ°é‡ç½®
- ğŸ›¡ï¸ AdminWhitelist - ç™½åå•ç®¡ç†
- ğŸ¤– Ai - AIèŠå¤©
- ğŸ“Š BotStatus - æœºå™¨äººçŠ¶æ€
- ğŸ“± GetContact - è·å–é€šè®¯å½•
- ğŸŒ¤ï¸ GetWeather - å¤©æ°”æŸ¥è¯¢
- ğŸ® Gomoku - äº”å­æ£‹æ¸¸æˆ
- ğŸŒ… GoodMorning - æ—©å®‰é—®å€™
- ğŸ“ˆ Leaderboard - ç§¯åˆ†æ’è¡Œ
- ğŸ² LuckyDraw - å¹¸è¿æŠ½å¥–
- ğŸ“‹ Menu - èœå•ç³»ç»Ÿ
- ğŸµ Music - ç‚¹æ­Œç³»ç»Ÿ
- ğŸ“° News - æ–°é—»æ¨é€
- ğŸ’± PointTrade - ç§¯åˆ†äº¤æ˜“
- ğŸ’° QueryPoint - ç§¯åˆ†æŸ¥è¯¢
- ğŸ¯ RandomMember - éšæœºç¾¤æˆå‘˜
- ğŸ–¼ï¸ RandomPicture - éšæœºå›¾ç‰‡
- ğŸ§§ RedPacket - çº¢åŒ…ç³»ç»Ÿ
- âœï¸ SignIn - æ¯æ—¥ç­¾åˆ°
- âœˆï¸ Warthunder - æˆ˜äº‰é›·éœ†æŸ¥è¯¢

# ğŸš€ éƒ¨ç½²è¯´æ˜

## ğŸ³ Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

### 1. ğŸ”§ å‡†å¤‡ç¯å¢ƒ

éœ€è¦å®‰è£… Docker å’Œ Docker Compose:

- ğŸ‹ Docker å®‰è£…: https://docs.docker.com/get-started/get-docker/
- ğŸ”„ Docker Compose å®‰è£…: https://docs.docker.com/compose/install/

2. â¬‡ï¸ æ‹‰å–æœ€æ–°é•œåƒ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/HenryXiaoYang/XYBotV2.git
cd XYBotV2

# æ‹‰å–é•œåƒ
docker-compose pull
```

3. ğŸš€ å¯åŠ¨å®¹å™¨

```bash
# é¦–æ¬¡å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps
```

4. ğŸ“± æŸ¥çœ‹æ—¥å¿—ç„¶åç™»å½•å¾®ä¿¡

```bash
# æŸ¥çœ‹æ—¥å¿—è·å–ç™»å½•äºŒç»´ç 
docker-compose logs -f xybotv2
```

æ‰«æç»ˆç«¯æ˜¾ç¤ºçš„äºŒç»´ç å®Œæˆç™»å½•ã€‚ï¼ˆå¦‚æœæ‰«ä¸å‡ºæ¥,å¯ä»¥æ‰“å¼€é“¾æ¥æ‰«ç ï¼‰ã€‚é¦–æ¬¡ç™»å½•æˆåŠŸå,éœ€è¦æŒ‚æœº4å°æ—¶ã€‚ä¹‹åæœºå™¨äººå°±ä¼šè‡ªåŠ¨å¼€å§‹æ­£å¸¸è¿è¡Œã€‚

5. âš™ï¸ é…ç½®æ–‡ä»¶ä¿®æ”¹

```bash
# æŸ¥çœ‹æ•°æ®å·ä½ç½®
docker volume inspect xybotv2

# ç¼–è¾‘å¯¹åº”ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶
xybotv2-volumes-dir/_data/main_config.toml
xybotv2-volumes-dir/_data/plugins/all_in_one_config.toml
```

ä¿®æ”¹é…ç½®åéœ€è¦é‡å¯å®¹å™¨ä½¿é…ç½®ç”Ÿæ•ˆ:

```bash
docker-compose restart xybotv2
```

> [!TIP]
> å¦‚æœæ˜¯ä¿®æ”¹æ’ä»¶é…ç½®åˆ™å¯ä½¿ç”¨çƒ­åŠ è½½ã€çƒ­å¸è½½ã€çƒ­é‡è½½æŒ‡ä»¤ï¼Œä¸ç”¨é‡å¯æœºå™¨äººã€‚

### â“ å¸¸è§é—®é¢˜

1. ğŸ”Œ Redis è¿æ¥å¤±è´¥

- æ£€æŸ¥ DragonFly æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- ç¡®è®¤ main_config.toml ä¸­çš„ redis-host é…ç½®æ˜¯å¦æ­£ç¡®

2. âš ï¸ é…ç½®æ–‡ä»¶ä¿®æ”¹æœªç”Ÿæ•ˆ

- é‡å¯å®¹å™¨: `docker-compose restart xybotv2`
- æ£€æŸ¥é…ç½®æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡®

3. ğŸ“ æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose logs -f xybotv2

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
docker-compose logs --tail=100 xybotv2
```

## ğŸ’» ç›´æ¥éƒ¨ç½²

### ğŸªŸ Windows éƒ¨ç½²æ­¥éª¤

#### 1. ğŸ”§ ç¯å¢ƒå‡†å¤‡

- å®‰è£… Python 3.11 (å¿…é¡»æ˜¯3.11ç‰ˆæœ¬): https://www.python.org/downloads/release/python-31111/
    - åœ¨å®‰è£…è¿‡ç¨‹ä¸­å‹¾é€‰ "Add Python to PATH" é€‰é¡¹
    - æˆ–è€…æ‰‹åŠ¨æ·»åŠ ï¼š
        1. å³é”®ç‚¹å‡» "æ­¤ç”µè„‘" -> "å±æ€§" -> "é«˜çº§ç³»ç»Ÿè®¾ç½®" -> "ç¯å¢ƒå˜é‡"
        2. åœ¨ "ç³»ç»Ÿå˜é‡" ä¸­æ‰¾åˆ° Path,ç‚¹å‡» "ç¼–è¾‘"
        3. æ·»åŠ  Python å®‰è£…ç›®å½•ï¼ˆå¦‚ `C:\Python311`ï¼‰å’Œ Scripts ç›®å½•ï¼ˆå¦‚ `C:\Python311\Scripts`ï¼‰

- å®‰è£… ffmpeg:
    1. ä» [ffmpegå®˜ç½‘](https://www.ffmpeg.org/download.html) ä¸‹è½½ Windows ç‰ˆæœ¬
    2. è§£å‹åˆ°åˆé€‚çš„ç›®å½•ï¼ˆå¦‚ `C:\ffmpeg`ï¼‰
    3. æ·»åŠ ç¯å¢ƒå˜é‡ï¼š
        - å³é”®ç‚¹å‡» "æ­¤ç”µè„‘" -> "å±æ€§" -> "é«˜çº§ç³»ç»Ÿè®¾ç½®" -> "ç¯å¢ƒå˜é‡"
        - åœ¨ "ç³»ç»Ÿå˜é‡" ä¸­æ‰¾åˆ° Pathï¼Œç‚¹å‡» "ç¼–è¾‘"
        - æ·»åŠ  ffmpeg çš„ bin ç›®å½•è·¯å¾„ï¼ˆå¦‚ `C:\ffmpeg\bin`ï¼‰
    4. è®¾ç½® IMAGEIO_FFMPEG_EXE ç¯å¢ƒå˜é‡ï¼š
        - åœ¨ "ç³»ç»Ÿå˜é‡" ä¸­ç‚¹å‡» "æ–°å»º"
        - å˜é‡åè¾“å…¥ï¼š`IMAGEIO_FFMPEG_EXE`
        - å˜é‡å€¼è¾“å…¥ ffmpeg.exe çš„å®Œæ•´è·¯å¾„ï¼ˆå¦‚ `C:\ffmpeg\bin\ffmpeg.exe`ï¼‰
    5. é‡å¯å‘½ä»¤æç¤ºç¬¦æˆ– PowerShell ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ
    6. éªŒè¯å®‰è£…ï¼š
        ```bash
        ffmpeg -version
        ```

- å®‰è£… Redis for Windows:
    - ä» [Redis-Windows](https://github.com/redis-windows/redis-windows/releases) ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ (ç›®å‰æ˜¯7.4.2)
    - ä¸‹è½½ `Redis-7.4.2-Windows-x64-msys2-with-Service.zip` (æ¨è,ä½¿ç”¨MSYS2ç¼–è¯‘çš„æœåŠ¡ç‰ˆæœ¬)
    - è§£å‹åˆ°åˆé€‚çš„ç›®å½•(å¦‚ `C:\Redis`)
    - ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell æˆ–å‘½ä»¤æç¤ºç¬¦,æ‰§è¡Œ:
      ```bash
      # è¿›å…¥Redisç›®å½•
      cd C:\Redis
      
      # å®‰è£…RedisæœåŠ¡
      redis-server.exe --service-install redis.windows.conf
      
      # å¯åŠ¨RedisæœåŠ¡
      redis-server.exe --service-start
      
      # éªŒè¯Redisæ˜¯å¦æ­£å¸¸è¿è¡Œ
      redis-cli.exe ping
      # å¦‚æœè¿”å›PONGåˆ™è¡¨ç¤ºRediså·²æˆåŠŸè¿è¡Œ
      ```

#### 2. â¬‡ï¸ ä¸‹è½½é¡¹ç›®

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/HenryXiaoYang/XYBotV2.git
# å°ç™½ï¼šç›´æ¥ Github Download ZIP

cd XYBotV2

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
.\venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# ä½¿ç”¨é•œåƒæºå®‰è£…
pip install -r requirements.txt -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple
```

#### 3. ğŸš€ å¯åŠ¨æœºå™¨äºº

```bash
# ç¡®ä¿RedisæœåŠ¡å·²å¯åŠ¨
redis-cli ping  # å¦‚æœè¿”å›PONGåˆ™è¡¨ç¤ºRedisæ­£å¸¸è¿è¡Œ

# å¯åŠ¨æœºå™¨äºº
python main.py
```

#### 4. ğŸ“± ç™»å½•å¾®ä¿¡

- æ‰«æç»ˆç«¯æ˜¾ç¤ºçš„äºŒç»´ç å®Œæˆç™»å½•ã€‚å¦‚æœæ‰«ä¸å‡ºæ¥,å¯ä»¥æ‰“å¼€äºŒç»´ç ä¸‹é¢çš„é“¾æ¥æ‰«ç ã€‚
- é¦–æ¬¡ç™»å½•æˆåŠŸå,éœ€è¦æŒ‚æœº4å°æ—¶ã€‚ä¹‹åæœºå™¨äººå°±ä¼šå¼€å§‹æ­£å¸¸è¿è¡Œã€‚

#### 5. âš™ï¸ é…ç½®æ–‡ä»¶ä¿®æ”¹

ä¸»é…ç½®: main_config.toml ä¸»é…ç½®æ–‡ä»¶

æ’ä»¶é…ç½®: plugins/all_in_one_config.toml æ’ä»¶é…ç½®æ–‡ä»¶

è¿™å‡ ä¸ªæ’ä»¶éœ€è¦é…ç½®APIå¯†é’¥æ‰å¯æ­£å¸¸å·¥ä½œ:

- ğŸ¤– Ai
- ğŸŒ¤ï¸ GetWeather


- å¦‚æœæœºå™¨äººæ­£åœ¨è¿è¡Œï¼Œéœ€è¦é‡å¯æ‰èƒ½ä½¿ä¸»é…ç½®ç”Ÿæ•ˆï¼š
    ```bash
    # æŒ‰Ctrl+Cåœæ­¢æœºå™¨äºº
    # é‡æ–°å¯åŠ¨
    python main.py
    ```

> [!TIP]
> å¦‚æœæ˜¯ä¿®æ”¹æ’ä»¶é…ç½®åˆ™å¯ä½¿ç”¨çƒ­åŠ è½½ã€çƒ­å¸è½½ã€çƒ­é‡è½½æŒ‡ä»¤ï¼Œä¸ç”¨é‡å¯æœºå™¨äººã€‚

### ğŸ§ Linux éƒ¨ç½²æ­¥éª¤

#### 1. ğŸ”§ ç¯å¢ƒå‡†å¤‡

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3.11 python3.11-venv redis-server ffmpeg

# CentOS/RHEL
sudo yum install epel-release  # å¦‚æœéœ€è¦EPELä»“åº“
sudo yum install python3.11 redis ffmpeg
sudo systemctl start redis
sudo systemctl enable redis

# è®¾ç½® IMAGEIO_FFMPEG_EXE ç¯å¢ƒå˜é‡
echo 'export IMAGEIO_FFMPEG_EXE=$(which ffmpeg)' >> ~/.bashrc
source ~/.bashrc

# å¦‚æœä½¿ç”¨å…¶ä»–shell(å¦‚zsh)ï¼Œåˆ™éœ€è¦ï¼š
# echo 'export IMAGEIO_FFMPEG_EXE=$(which ffmpeg)' >> ~/.zshrc
# source ~/.zshrc
```

#### 2. â¬‡ï¸ ä¸‹è½½é¡¹ç›®

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/HenryXiaoYang/XYBotV2.git
# å°ç™½ï¼šç›´æ¥ Github Download ZIP

cd XYBotV2

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3.11 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# ä½¿ç”¨é•œåƒæºå®‰è£…
pip install -r requirements.txt -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple
```

4. ğŸš€ å¯åŠ¨æœºå™¨äºº

```bash
# ç¡®ä¿åœ¨è™šæ‹Ÿç¯å¢ƒä¸­
source venv/bin/activate

# æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
systemctl status redis

# å¦‚æœRedisæœªè¿è¡Œï¼Œå¯åŠ¨æœåŠ¡
sudo systemctl start redis

# è®¾ç½®Rediså¼€æœºè‡ªå¯
sudo systemctl enable redis

# éªŒè¯Redisè¿æ¥
redis-cli ping
# å¦‚æœè¿”å›PONGè¡¨ç¤ºè¿æ¥æ­£å¸¸

# å¯åŠ¨æœºå™¨äºº
python3 main.py
```

5. ğŸ“± ç™»å½•å¾®ä¿¡

- æ‰«æç»ˆç«¯æ˜¾ç¤ºçš„äºŒç»´ç å®Œæˆç™»å½•ã€‚å¦‚æœæ‰«ä¸å‡ºæ¥,å¯ä»¥æ‰“å¼€äºŒç»´ç ä¸‹é¢çš„é“¾æ¥æ‰«ç ã€‚
- é¦–æ¬¡ç™»å½•æˆåŠŸå,éœ€è¦æŒ‚æœº4å°æ—¶ã€‚ä¹‹åæœºå™¨äººå°±ä¼šå¼€å§‹æ­£å¸¸è¿è¡Œã€‚

6. âš™ï¸ é…ç½®æ–‡ä»¶ä¿®æ”¹

ä¸»é…ç½®: main_config.toml ä¸»é…ç½®æ–‡ä»¶

æ’ä»¶é…ç½®: plugins/all_in_one_config.toml æ’ä»¶é…ç½®æ–‡ä»¶

è¿™å‡ ä¸ªæ’ä»¶éœ€è¦é…ç½®APIå¯†é’¥æ‰å¯æ­£å¸¸å·¥ä½œ:

- ğŸ¤– Ai
- ğŸŒ¤ï¸ GetWeather

- å¦‚æœæœºå™¨äººæ­£åœ¨è¿è¡Œï¼Œéœ€è¦é‡å¯æ‰èƒ½ä½¿ä¸»é…ç½®ç”Ÿæ•ˆï¼š
    ```bash
    # æŒ‰Ctrl+Cåœæ­¢æœºå™¨äºº
    # é‡æ–°å¯åŠ¨
    python main.py
    ```

> [!TIP]
> å¦‚æœæ˜¯ä¿®æ”¹æ’ä»¶é…ç½®åˆ™å¯ä½¿ç”¨çƒ­åŠ è½½ã€çƒ­å¸è½½ã€çƒ­é‡è½½æŒ‡ä»¤ï¼Œä¸ç”¨é‡å¯æœºå™¨äººã€‚

# ğŸ”¨ å¼€å‘è¯´æ˜

## ğŸ§© æ’ä»¶å¼€å‘

æ‰€æœ‰æ’ä»¶éœ€ç»§æ‰¿ `PluginBase` ç±»,å®ç°ç›¸åº”çš„å¤„ç†æ–¹æ³•ã€‚ç¤ºä¾‹:

```python
from loguru import logger

from WechatAPI import WechatAPIClient
from utils.decorators import *
from utils.plugin_base import PluginBase


class ExamplePlugin(PluginBase):
    description = "ç¤ºä¾‹æ’ä»¶"
    author = "HenryXiaoYang"
    version = "1.0.0"

    def __init__(self):
        super().__init__()

    @on_text_message
    async def handle_text(self, bot: WechatAPIClient, message: dict):
        logger.info("æ”¶åˆ°äº†æ–‡æœ¬æ¶ˆæ¯")

    @on_at_message
    async def handle_at(self, bot: WechatAPIClient, message: dict):
        logger.info("æ”¶åˆ°äº†è¢«@æ¶ˆæ¯")

    @on_voice_message
    async def handle_voice(self, bot: WechatAPIClient, message: dict):
        logger.info("æ”¶åˆ°äº†è¯­éŸ³æ¶ˆæ¯")

    @on_image_message
    async def handle_image(self, bot: WechatAPIClient, message: dict):
        logger.info("æ”¶åˆ°äº†å›¾ç‰‡æ¶ˆæ¯")

    @on_video_message
    async def handle_video(self, bot: WechatAPIClient, message: dict):
        logger.info("æ”¶åˆ°äº†è§†é¢‘æ¶ˆæ¯")

    @on_file_message
    async def handle_file(self, bot: WechatAPIClient, message: dict):
        logger.info("æ”¶åˆ°äº†æ–‡ä»¶æ¶ˆæ¯")

    @on_quote_message
    async def handle_quote(self, bot: WechatAPIClient, message: dict):
        logger.info("æ”¶åˆ°äº†å¼•ç”¨æ¶ˆæ¯")

    @on_pat_message
    async def handle_pat(self, bot: WechatAPIClient, message: dict):
        logger.info("æ”¶åˆ°äº†æ‹ä¸€æ‹æ¶ˆæ¯")

    @on_emoji_message
    async def handle_emoji(self, bot: WechatAPIClient, message: dict):
        logger.info("æ”¶åˆ°äº†è¡¨æƒ…æ¶ˆæ¯")

    @schedule('interval', seconds=5)
    async def periodic_task(self, bot: WechatAPIClient):
        logger.info("æˆ‘æ¯5ç§’æ‰§è¡Œä¸€æ¬¡")

    @schedule('cron', hour=8, minute=30, second=30)
    async def daily_task(self, bot: WechatAPIClient):
        logger.info("æˆ‘æ¯å¤©æ—©ä¸Š8ç‚¹30åˆ†30ç§’æ‰§è¡Œ")

    @schedule('date', run_date='2025-01-29 00:00:00')
    async def new_year_task(self, bot: WechatAPIClient):
        logger.info("æˆ‘åœ¨2025å¹´1æœˆ29æ—¥æ‰§è¡Œ")
```